<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClientPacketHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SwtPra10-pc</a> &gt; <a href="index.source.html" class="el_package">de.thundergames.gameplay.player.networking</a> &gt; <span class="el_source">ClientPacketHandler.java</span></div><h1>ClientPacketHandler.java</h1><pre class="source lang-java linenums">/*
 * Copyright Notice for SwtPra10
 * Copyright (c) at ThunderGames | SwtPra10 2022
 * File created on 20.01.22, 18:32 by Carina Latest changes made by Carina on 20.01.22, 18:30 All contents of &quot;ClientPacketHandler&quot; are protected by copyright. The copyright law, unless expressly indicated otherwise, is
 * at ThunderGames | SwtPra10. All rights reserved
 * Any type of duplication, distribution, rental, sale, award,
 * Public accessibility or other use
 * requires the express written consent of ThunderGames | SwtPra10.
 */
package de.thundergames.gameplay.player.networking;

import com.google.gson.Gson;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import com.google.gson.reflect.TypeToken;
import de.thundergames.filehandling.Score;
import de.thundergames.gameplay.ai.AI;
import de.thundergames.gameplay.player.Client;
import de.thundergames.gameplay.player.board.GameBoard;
import de.thundergames.gameplay.player.ui.PlayerMenu;
import de.thundergames.gameplay.player.ui.gameselection.GameSelection;
import de.thundergames.gameplay.player.ui.gameselection.LobbyObserverGame;
import de.thundergames.gameplay.player.ui.tournamentselection.LobbyObserverTournament;
import de.thundergames.gameplay.player.ui.tournamentselection.TournamentSelection;
import de.thundergames.networking.server.PacketHandler;
import de.thundergames.networking.util.Packet;
import de.thundergames.networking.util.Packets;
import de.thundergames.playmechanics.game.Game;
import de.thundergames.playmechanics.game.GameState;
import de.thundergames.playmechanics.map.Field;
import de.thundergames.playmechanics.map.Map;
import de.thundergames.playmechanics.tournament.Tournament;
import de.thundergames.playmechanics.tournament.TournamentState;
import de.thundergames.playmechanics.util.Mole;
import de.thundergames.playmechanics.util.Player;
import lombok.Data;
import org.jetbrains.annotations.NotNull;

import java.util.ArrayList;
import java.util.List;
import java.util.Timer;
import java.util.TimerTask;

<span class="nc bnc" id="L44" title="All 34 branches missed.">@Data</span>
public class ClientPacketHandler {

<span class="nc" id="L47">  protected final Client client;</span>
<span class="nc" id="L48">  protected Timer timer;</span>
<span class="nc" id="L49">  protected boolean timerRunning = false;</span>
<span class="nc" id="L50">  protected Packet packet;</span>

  /**
   * @author Carina
   * @use handles the packet that came in
   * @see PacketHandler the packetHandler by the Server as a reference
   */
  public void handlePacket(@NotNull final Packet packet) {
<span class="nc" id="L58">    this.packet = packet;</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">    if (packet.getPacketType().equalsIgnoreCase(Packets.WELCOME.getPacketType())) {</span>
<span class="nc" id="L60">      handleWelcomePacket();</span>
<span class="nc" id="L61">      registerOverviewObserverPacket();</span>
<span class="nc" id="L62">      client.getClientPacketHandler().getOverviewPacket();</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.MESSAGE.getPacketType())) {</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">      if (packet.getValues() != null) {</span>
<span class="nc bnc" id="L65" title="All 4 branches missed.">        if (client.isDebug() &amp;&amp; packet.getValues().get(&quot;message&quot;) != null) {</span>
<span class="nc" id="L66">          System.out.println(&quot;Server sent: &quot; + packet.getValues().get(&quot;message&quot;));</span>
        }
      }
<span class="nc bnc" id="L69" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.ASSIGNEDTOGAME.getPacketType())) {</span>
<span class="nc" id="L70">      handleAssignedToGamePacket();</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.WELCOMEGAME.getPacketType())) {</span>
<span class="nc" id="L72">      handleWelcomeGamePacket();</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.PLAYERJOINED.getPacketType())) {</span>
<span class="nc" id="L74">      handlePlayerJoinedPacket();</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.PLAYERLEFT.getPacketType())) {</span>
<span class="nc" id="L76">      handlePlayerLeftPacket();</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.PLAYERKICKED.getPacketType())) {</span>
<span class="nc" id="L78">      handlePlayerKickedFromGame();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.OVERVIEW.getPacketType())) {</span>
<span class="nc" id="L80">      handleOverviewPacket();</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.SCORENOTIFICATION.getPacketType())) {</span>
<span class="nc" id="L82">      handleScoreNotificationPacket();</span>
<span class="nc" id="L83">    } else if (packet</span>
<span class="nc" id="L84">      .getPacketType()</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.GAMEHISTORYRESPONE.getPacketType())) {</span>
<span class="nc" id="L86">      handleGameHistoryResponsePacket();</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.REMAININGTIME.getPacketType())) {</span>
<span class="nc" id="L88">      handleRemainingTimePacket();</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.GAMESTARTED.getPacketType())) {</span>
<span class="nc" id="L90">      handleGameStartedPacket();</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.GAMEOVER.getPacketType())) {</span>
<span class="nc" id="L92">      handleGameOverPacket();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.GAMECONTINUED.getPacketType())) {</span>
<span class="nc" id="L94">      handleGameContinuedPacket();</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.GAMECANCELED.getPacketType())) {</span>
<span class="nc" id="L96">      handleGameCanceledPacket();</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.GAMEPAUSED.getPacketType())) {</span>
<span class="nc" id="L98">      handleGamePausedPacket();</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.PLAYERPLACESMOLE.getPacketType())) {</span>
<span class="nc" id="L100">      handlePlayerPlacesMolePacket();</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.PLAYERSTURN.getPacketType())) {</span>
<span class="nc" id="L102">      handlePlayersTurnPacket();</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.MOLEPLACED.getPacketType())) {</span>
<span class="nc" id="L104">      handleMolePlacedPacket();</span>
<span class="nc" id="L105">    } else if (packet</span>
<span class="nc" id="L106">      .getPacketType()</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.MOVEPENALTYNOTIFICATION.getPacketType())) {</span>
<span class="nc" id="L108">      handleMovePenaltyNotificationPacket();</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.PLAYERSKIPPED.getPacketType())) {</span>
<span class="nc" id="L110">      handlePlayerSkippedPacket();</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.NEXTLEVEL.getPacketType())) {</span>
<span class="nc" id="L112">      handleNextFloorPacket();</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.TOURNAMENTSCORE.getPacketType())) {</span>
<span class="nc" id="L114">      handleTournamentScorePacket();</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.MOLEMOVED.getPacketType())) {</span>
<span class="nc" id="L116">      handleMoleMovedPacket();</span>
<span class="nc" id="L117">    } else if (packet</span>
<span class="nc" id="L118">      .getPacketType()</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTSTATERESPONSE.getPacketType())) {</span>
<span class="nc" id="L120">      handleTournamentStateResponsePacket();</span>
<span class="nc" id="L121">    } else if (packet</span>
<span class="nc" id="L122">      .getPacketType()</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTSTARTED.getPacketType())) {</span>
<span class="nc" id="L124">      handleTournamentStartedPacket();</span>
<span class="nc" id="L125">    } else if (packet</span>
<span class="nc" id="L126">      .getPacketType()</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTPLAYERJOINED.getPacketType())) {</span>
<span class="nc" id="L128">      handleTournamentPlayerJoinedPacket();</span>
<span class="nc" id="L129">    } else if (packet</span>
<span class="nc" id="L130">      .getPacketType()</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTPLAYERLEFT.getPacketType())) {</span>
<span class="nc" id="L132">      handleTournamentPlayerLeftPacket();</span>
<span class="nc" id="L133">    } else if (packet</span>
<span class="nc" id="L134">      .getPacketType()</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTPLAYERKICKED.getPacketType())) {</span>
<span class="nc" id="L136">      handleTournamentPlayerKickedPacket();</span>
<span class="nc" id="L137">    } else if (packet</span>
<span class="nc" id="L138">      .getPacketType()</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTPLAYERINGAME.getPacketType())) {</span>
<span class="nc" id="L140">      handleTournamentPlayerInGamePacket();</span>
<span class="nc" id="L141">    } else if (packet</span>
<span class="nc" id="L142">      .getPacketType()</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTGAMESOVERVIEW.getPacketType())) {</span>
<span class="nc" id="L144">      handleTournamentGamesOverviewPacket();</span>
<span class="nc" id="L145">    } else if (packet</span>
<span class="nc" id="L146">      .getPacketType()</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">      .equalsIgnoreCase(Packets.TOURNAMENTPLAYERINLOBBY.getPacketType())) {</span>
<span class="nc" id="L148">      handleTournamentPlayerInLobbyPacket();</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">    } else if (packet.getPacketType().equalsIgnoreCase(Packets.TOURNAMENTOVER.getPacketType())) {</span>
<span class="nc" id="L150">      handleTournamentOverPacket();</span>
    } else {
<span class="nc bnc" id="L152" title="All 2 branches missed.">      for (var packets : Packets.values()) {</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (packets.getPacketType().equalsIgnoreCase(packet.getPacketType())) {</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">          if (client.isDebug()) {</span>
<span class="nc" id="L155">            System.out.println(&quot;The packet: &quot; + packet.getPacketType() + &quot; is not handled by the client!&quot;);</span>
<span class="nc" id="L156">            return;</span>
          }
        }
      }
<span class="nc bnc" id="L160" title="All 2 branches missed.">      if (client.isDebug()) {</span>
<span class="nc" id="L161">        System.out.println(&quot;Packet not found: &quot; + packet.getPacketType());</span>
      }
    }
<span class="nc" id="L164">  }</span>

  /**
   * @author Marc
   * @use send to service to get tournament score
   */
  public void getTournamentScorePacket(int tournamentID) {
<span class="nc" id="L171">    var object = new JsonObject();</span>
<span class="nc" id="L172">    var json = new JsonObject();</span>
<span class="nc" id="L173">    object.addProperty(&quot;type&quot;, Packets.TOURNAMENTSCORE.getPacketType());</span>
<span class="nc" id="L174">    json.addProperty(&quot;tournamentID&quot;, tournamentID);</span>
<span class="nc" id="L175">    object.add(&quot;value&quot;, json);</span>
<span class="nc" id="L176">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L177">    showTournamentScore();</span>
<span class="nc" id="L178">  }</span>

  /**
   * @author Marc
   * @use called on tournament start
   */
  private void handleTournamentStartedPacket() {
<span class="nc" id="L185">    client.setTournamentState(new Gson().fromJson(packet.getValues().get(&quot;tournamentState&quot;), TournamentState.class));</span>
<span class="nc" id="L186">  }</span>

  /**
   * @author Marc
   * @use called if player is back at tournament lobby
   */
  private void handleTournamentPlayerInLobbyPacket() {
<span class="nc" id="L193">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc" id="L194">  }</span>

  /**
   * @author Carina
   * @use send to client that he wants the overview for all objects
   */
  public void getOverviewPacket() {
<span class="nc" id="L201">    var object = new JsonObject();</span>
<span class="nc" id="L202">    object.addProperty(&quot;type&quot;, Packets.GETOVERVIEW.getPacketType());</span>
<span class="nc" id="L203">    object.add(&quot;value&quot;, new JsonObject());</span>
<span class="nc" id="L204">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L205">  }</span>

  /**
   * @author Carina
   * @use handles the client tournament when the tournament is over
   */
  protected void handleTournamentOverPacket() {
<span class="nc" id="L212">    updateTableView();</span>
<span class="nc" id="L213">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc" id="L215">      observerGameBoard.tournamentOver();</span>
    }
<span class="nc" id="L217">  }</span>

  /**
   * @author Carina
   * @use handles the leftment of a player from the tournament
   */
  protected void handleTournamentPlayerLeftPacket() {
<span class="nc" id="L224">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc" id="L225">    var lobbyObserverTournament = LobbyObserverTournament.getObserver();</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">    if (lobbyObserverTournament != null) lobbyObserverTournament.showPlayerLeave(player);</span>
<span class="nc" id="L227">    updateTableView();</span>
<span class="nc" id="L228">  }</span>

  /**
   * @author Carina
   * @use handles the new overview of all running tournaments
   */
  protected void handleTournamentGamesOverviewPacket() {
<span class="nc" id="L235">    client</span>
<span class="nc" id="L236">      .getTournaments()</span>
<span class="nc" id="L237">      .addAll(</span>
        new Gson()
<span class="nc" id="L239">          .fromJson(</span>
<span class="nc" id="L240">            packet.getValues().get(&quot;games&quot;),</span>
<span class="nc" id="L241">            new TypeToken&lt;ArrayList&lt;Game&gt;&gt;() {</span>
<span class="nc" id="L242">            }.getType()));</span>
<span class="nc" id="L243">    updateTableView();</span>
<span class="nc" id="L244">  }</span>

  /**
   * @author Carina
   * @use handles that a player is in game in the tournament
   */
  protected void handleTournamentPlayerInGamePacket() {
<span class="nc" id="L251">  }</span>

  /**
   * @author Carina
   * @use handles the kick of a player from the tournament
   */
  protected void handleTournamentPlayerKickedPacket() {
<span class="nc" id="L258">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc" id="L259">    updateTableView();</span>
<span class="nc" id="L260">    var lobbyObserverTournament = LobbyObserverTournament.getObserver();</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">    if (lobbyObserverTournament != null) lobbyObserverTournament.showPlayerKicked(player);</span>
<span class="nc" id="L262">  }</span>

  /**
   * @author Carina
   * @use sends the leave tournament packet to the server
   */
  public void leaveTournament(final int tournamentID) {
<span class="nc" id="L269">    var object = new JsonObject();</span>
<span class="nc" id="L270">    var json = new JsonObject();</span>
<span class="nc" id="L271">    object.addProperty(&quot;type&quot;, Packets.LEAVETOURNAMENT.getPacketType());</span>
<span class="nc" id="L272">    json.addProperty(&quot;tournamentID&quot;, tournamentID);</span>
<span class="nc" id="L273">    object.add(&quot;value&quot;, json);</span>
<span class="nc" id="L274">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L275">    updateTableView();</span>


<span class="nc" id="L278">  }</span>

  /**
   * @author Carina
   * @use handles the joining of a player into the tournament
   */
  protected void handleTournamentPlayerJoinedPacket() {
<span class="nc" id="L285">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc" id="L286">    updateTableView();</span>
<span class="nc" id="L287">    var lobbyObserverTournament = LobbyObserverTournament.getObserver();</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">    if (lobbyObserverTournament != null) lobbyObserverTournament.showPLayerJoin(player);</span>
<span class="nc" id="L289">  }</span>

  /**
   * @param tournamentID
   * @param participant
   * @author Carina
   * @use sends the joining of a tournament to the client
   */
  public void enterTournamentPacket(final int tournamentID, final boolean participant) {
<span class="nc" id="L298">    var object = new JsonObject();</span>
<span class="nc" id="L299">    var json = new JsonObject();</span>
<span class="nc" id="L300">    object.addProperty(&quot;type&quot;, Packets.ENTERTOURNAMENT.getPacketType());</span>
<span class="nc" id="L301">    json.addProperty(&quot;tournamentID&quot;, tournamentID);</span>
<span class="nc" id="L302">    json.addProperty(&quot;participant&quot;, participant);</span>
<span class="nc" id="L303">    object.add(&quot;value&quot;, json);</span>
<span class="nc" id="L304">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L305">  }</span>

  /**
   * @author Carina
   * @use is called everytime a map gets updated
   */
  public void updateMap() {
<span class="nc" id="L312">    var gameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">    if (gameBoard != null) {</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">      if (gameBoard.getGameHandler() != null) gameBoard.updateGameBoard();</span>
    }
<span class="nc" id="L316">  }</span>

  /**
   * @author Carina
   * @use is called everytime a map gets updated
   */
  public void updateMoleMoved(Field from, Field to, Mole mole, int pullDisc) {
<span class="nc" id="L323">    var gameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">    if (gameBoard != null) {</span>
<span class="nc" id="L325">      gameBoard.moveMole(from, to, mole.getPlayer().getClientID(), pullDisc);</span>
<span class="nc" id="L326">      gameBoard.updatePullDiscs(mole.getPlayer(), pullDisc);</span>
    }
<span class="nc" id="L328">  }</span>

  /**
   * @author Carina
   * @use is called everytime a map gets updated
   */
  public void updateMolePlaced(Mole mole) {
<span class="nc" id="L335">    var gameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">    if (gameBoard != null) gameBoard.placeMole(mole);</span>
<span class="nc" id="L337">  }</span>

  /**
   * @author Carina
   * @use handles the movement of a mole send by the server from a client
   */
  protected void handleMoleMovedPacket() {
<span class="nc" id="L344">    var from = new Gson().fromJson(packet.getValues().get(&quot;from&quot;), Field.class);</span>
<span class="nc" id="L345">    var to = new Gson().fromJson(packet.getValues().get(&quot;to&quot;), Field.class);</span>
<span class="nc" id="L346">    var pullDisc = new Gson().fromJson(packet.getValues().get(&quot;pullDisc&quot;), Integer.class);</span>
<span class="nc" id="L347">    var moleObject = client.getMap().getFieldMap().get(List.of(from.getX(), from.getY())).getMole();</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L349">      System.out.println(</span>
        &quot;Client: A mole has been moved&quot;
          + &quot; from &quot;
          + from
          + &quot; to &quot;
          + to
          + &quot;\n&quot;);
    }
<span class="nc bnc" id="L357" title="All 2 branches missed.">    if (moleObject == null) {</span>
<span class="nc" id="L358">      System.exit(9);</span>
    }
<span class="nc" id="L360">    client.getMap().getFieldMap().get(List.of(from.getX(), from.getY())).setOccupied(false);</span>
<span class="nc" id="L361">    client.getMap().getFieldMap().get(List.of(to.getX(), to.getY())).setOccupied(true);</span>
<span class="nc" id="L362">    client.getMap().getFieldMap().get(List.of(to.getX(), to.getY())).setMole(moleObject);</span>
<span class="nc" id="L363">    client.getMap().getFieldMap().get(List.of(from.getX(), from.getY())).setMole(null);</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">    for (var mole : client.getMoles()) {</span>
<span class="nc bnc" id="L365" title="All 4 branches missed.">      if (mole.getPosition().getX() == from.getX() &amp;&amp; mole.getPosition().getY() == from.getY()) {</span>
<span class="nc" id="L366">        mole.setPosition(to);</span>
<span class="nc" id="L367">        break;</span>
      }
<span class="nc" id="L369">    }</span>
<span class="nc" id="L370">    updateMoleMoved(from, to, moleObject, pullDisc);</span>
<span class="nc" id="L371">    checkForStopRemainingTime();</span>
<span class="nc" id="L372">    stopRemainingTime();</span>
<span class="nc" id="L373">  }</span>

  /**
   * @author Carina
   * @use handles the tournament score send by the server
   */
  protected void handleTournamentScorePacket() {
<span class="nc" id="L380">    var score = new Gson().fromJson(packet.getValues().get(&quot;result&quot;), Score.class);</span>
<span class="nc" id="L381">  }</span>

  /**
   * @author Carina
   * @use handles when the client gets the new floor
   */
  protected void handleNextFloorPacket() {
<span class="nc bnc" id="L388" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L389">      System.out.println(&quot;Client got the new level!&quot;);</span>
    }
<span class="nc" id="L391">    var players =</span>
      new ArrayList&lt;Player&gt;(
        new Gson()
<span class="nc" id="L394">          .fromJson(</span>
<span class="nc" id="L395">            packet.getValues().get(&quot;eliminatedPlayers&quot;),</span>
<span class="nc" id="L396">            new TypeToken&lt;ArrayList&lt;Player&gt;&gt;() {</span>
<span class="nc" id="L397">            }.getType()));</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L399">      System.out.println(&quot;Players that are out: &quot;);</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">      for (Player player : players) {</span>
<span class="nc" id="L401">        System.out.println(player);</span>
<span class="nc" id="L402">      }</span>
    }
<span class="nc" id="L404">    client.setGameState(new Gson().fromJson(packet.getValues().get(&quot;gameState&quot;), GameState.class));</span>
<span class="nc" id="L405">    updateScoreTable();</span>
<span class="nc" id="L406">    handleFloor();</span>
<span class="nc" id="L407">  }</span>

  /**
   * @author Carina
   * @use handles the floor send by the server to do everything to get it ready
   */
  protected void handleFloor() {
<span class="nc" id="L414">    client.getMoles().clear();</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">    if (client.getGameState().getPullDiscs().containsKey(client.getClientThread().getThreadID())) {</span>
<span class="nc" id="L416">      client</span>
<span class="nc" id="L417">        .getPullDiscs()</span>
<span class="nc" id="L418">        .addAll(client.getGameState().getPullDiscs().get(client.getClientThread().getThreadID()));</span>
    }
    // Muss gemacht werden damit der code sicher arbeitet
<span class="nc" id="L421">    client.setMap(</span>
      new Map(
<span class="nc" id="L423">        client.getGameState().getFloor().getHoles(),</span>
<span class="nc" id="L424">        client.getGameState().getFloor().getDrawAgainFields(),</span>
<span class="nc" id="L425">        client.getGameState().getFloor().getPoints()));</span>
<span class="nc" id="L426">    client.getMap().build(client.getGameState());</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">    if (!client.getGameState().getPlacedMoles().isEmpty()) {</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">      for (var moles : client.getGameState().getPlacedMoles()) {</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">        if (moles.getPlayer().getClientID() == client.getClientThread().getThreadID()) {</span>
<span class="nc" id="L430">          client.getMoles().add(moles);</span>
        }
<span class="nc" id="L432">      }</span>
    }
<span class="nc" id="L434">    updateMap();</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L436">      client.getMap().printMap();</span>
    }
<span class="nc" id="L438">  }</span>

  /**
   * @author Carina
   * @use handles when a player skipped his turn
   */
  protected void handlePlayerSkippedPacket() {
<span class="nc" id="L445">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">      if (player.equals(client.getPlayer())) {</span>
<span class="nc" id="L448">        System.out.println(&quot;Client is skipping this turn!&quot;);</span>
      } else {
<span class="nc" id="L450">        System.out.println(&quot;The Playermodel &quot; + player.getName() + &quot; skipped his turn!&quot;);</span>
      }
    }
<span class="nc" id="L453">    updateGameLog(player, &quot; übersprungen.\n&quot;);</span>
<span class="nc" id="L454">    checkForStopRemainingTime();</span>
<span class="nc" id="L455">  }</span>

  /**
   * @author Carina
   * @use handles the response after joining a tournament
   */
  protected void handleTournamentStateResponsePacket() {
<span class="nc" id="L462">    client.setTournamentState(new Gson().fromJson(packet.getValues().get(&quot;tournamentState&quot;), TournamentState.class));</span>
<span class="nc" id="L463">  }</span>

  /**
   * @author Carina
   * @use handles if a client did an invalid handling with a punishment
   */
  protected void handleMovePenaltyNotificationPacket() {
<span class="nc bnc" id="L470" title="All 2 branches missed.">    if (client.isDebug())</span>
<span class="nc" id="L471">      System.out.println(</span>
        &quot;The client &quot;
          + new Gson()
<span class="nc" id="L474">          .fromJson(packet.getValues().get(&quot;player&quot;), Player.class)</span>
<span class="nc" id="L475">          .getName()</span>
          + &quot; got a move penalty for the reason&quot;
<span class="nc" id="L477">          + packet.getValues().get(&quot;reason&quot;));</span>
<span class="nc" id="L478">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc" id="L479">    var penalty = packet.getValues().get(&quot;penalty&quot;).getAsString();</span>
<span class="nc" id="L480">    var reason = packet.getValues().get(&quot;reason&quot;).getAsString();</span>
<span class="nc" id="L481">    var deductedPoints = packet.getValues().get(&quot;deductedPoints&quot;).getAsString();</span>
<span class="nc" id="L482">    checkForStopRemainingTime();</span>
<span class="nc" id="L483">    showPenalty(player, penalty, reason, deductedPoints);</span>
<span class="nc" id="L484">    stopRemainingTime();</span>
<span class="nc" id="L485">  }</span>

  /**
   * @author Carina
   * @use handles the placement of a mole
   */
  protected void handleMolePlacedPacket() {
<span class="nc" id="L492">    var mole = new Gson().fromJson(packet.getValues().get(&quot;mole&quot;), Mole.class);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">    if (mole.getPlayer().getClientID() == client.getClientThread().getThreadID()) {</span>
<span class="nc" id="L494">      client.getMoles().add(mole);</span>
    }
<span class="nc" id="L496">    client.getMap().getFieldMap().get(List.of(mole.getPosition().getX(), mole.getPosition().getY())).setOccupied(true);</span>
<span class="nc" id="L497">    client.getMap().getFieldMap().get(List.of(mole.getPosition().getX(), mole.getPosition().getY())).setMole(mole);</span>
<span class="nc" id="L498">    client.getGameState().getPlacedMoles().add(mole);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L500">      System.out.println(&quot;Client: A mole has been placed at: &quot; + mole.getPosition().toString() + &quot;\n&quot;);</span>
    }
<span class="nc" id="L502">    updateMolePlaced(mole);</span>
<span class="nc" id="L503">    checkForStopRemainingTime();</span>
<span class="nc" id="L504">    stopRemainingTime();</span>
<span class="nc" id="L505">  }</span>

  /**
   * @author Carina
   * @use handles if the player is now on the turn
   */
  protected void handlePlayersTurnPacket() {
<span class="nc" id="L512">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc" id="L513">    client.setCurrentPlayer(player);</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L515">      System.out.println(</span>
        &quot;The Client &quot;
          + new Gson()
<span class="nc" id="L518">          .fromJson(packet.getValues().get(&quot;player&quot;), Player.class)</span>
<span class="nc" id="L519">          .getName()</span>
          + &quot; needs to move a mole within the next : &quot;
<span class="nc" id="L521">          + (packet.getValues().get(&quot;until&quot;).getAsLong() - System.currentTimeMillis()) + &quot; seconds!&quot;);</span>
    }
<span class="nc bnc" id="L523" title="All 2 branches missed.">    if (player.getClientID() == client.getClientThread().getThreadID()) {</span>
<span class="nc" id="L524">      client.getPullDiscs().clear();</span>
<span class="nc" id="L525">      client.getPullDiscs().addAll(new Gson()</span>
<span class="nc" id="L526">        .fromJson(</span>
<span class="nc" id="L527">          packet.getValues().get(&quot;pullDiscs&quot;),</span>
<span class="nc" id="L528">          new TypeToken&lt;ArrayList&lt;Integer&gt;&gt;() {</span>
<span class="nc" id="L529">          }.getType()));</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">      if (client.isDebug()) {</span>
<span class="nc" id="L531">        System.out.println(&quot;Client is now on the turn!&quot;);</span>
      }
<span class="nc" id="L533">      client.setDraw(true);</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">      if (!timerRunning) {</span>
<span class="nc" id="L535">        timerRunning = true;</span>
<span class="nc" id="L536">        timer = new Timer();</span>
<span class="nc" id="L537">        timer.schedule(</span>
<span class="nc" id="L538">          new TimerTask() {</span>
            @Override
            public void run() {
<span class="nc bnc" id="L541" title="All 2 branches missed.">              if (client.isDraw()) {</span>
<span class="nc" id="L542">                client.setDraw(false);</span>
<span class="nc" id="L543">                timerRunning = false;</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">                if (client.isDebug()) {</span>
<span class="nc" id="L545">                  System.out.println(&quot;You ran out of time!&quot;);</span>
                }
              }
<span class="nc" id="L548">            }</span>
          },
<span class="nc" id="L550">          packet.getValues().get(&quot;until&quot;).getAsLong() - System.currentTimeMillis());</span>
      }
    } else {
<span class="nc bnc" id="L553" title="All 2 branches missed.">      if (client.isDebug()) {</span>
<span class="nc" id="L554">        System.out.println(</span>
          &quot;Client: the player with the id: &quot;
<span class="nc" id="L556">            + player.getClientID()</span>
            + &quot; and name: &quot;
<span class="nc" id="L558">            + player.getName()</span>
            + &quot; is now on the turn!&quot;);
      }
    }
<span class="nc" id="L562">    updateGameLog(player, &quot; ist mit den Zugkarten &quot; + packet.getValues().get(&quot;pullDiscs&quot;) + &quot; an der Reihe.\n&quot;);</span>
<span class="nc" id="L563">    client.setRemainingDateTime(packet.getValues().get(&quot;until&quot;).getAsLong());</span>
<span class="nc" id="L564">    updateGameRemainingDateTime();</span>
<span class="nc" id="L565">    checkForStopRemainingTime();</span>
<span class="nc" id="L566">    continueRemainingTime();</span>
<span class="nc" id="L567">  }</span>

  /**
   * @param start
   * @param end
   * @param pullDisc
   * @author Carina
   * @use sends the movement of a mole to the server
   */
  public void makeMovePacket(final int[] start, final int[] end, final int pullDisc) {
<span class="nc" id="L577">    var object = new JsonObject();</span>
<span class="nc" id="L578">    var json = new JsonObject();</span>
<span class="nc" id="L579">    json.add(&quot;from&quot;, JsonParser.parseString(new Gson().toJson(new Field(start[0], start[1]))));</span>
<span class="nc" id="L580">    json.add(&quot;to&quot;, JsonParser.parseString(new Gson().toJson(new Field(end[0], end[1]))));</span>
<span class="nc" id="L581">    json.addProperty(&quot;pullDisc&quot;, pullDisc);</span>
<span class="nc" id="L582">    object.add(&quot;value&quot;, json);</span>
<span class="nc" id="L583">    object.addProperty(&quot;type&quot;, Packets.MAKEMOVE.getPacketType());</span>
<span class="nc" id="L584">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L585">  }</span>

  /**
   * @param field
   * @author Carina
   * @use handles that the player wants to place a mole at the position
   * @see Player
   * @see Field
   */
  public void placeMolePacket(@NotNull final Field field) {
<span class="nc" id="L595">    var object = new JsonObject();</span>
<span class="nc" id="L596">    var json = new JsonObject();</span>
<span class="nc" id="L597">    object.addProperty(&quot;type&quot;, Packets.PLACEMOLE.getPacketType());</span>
<span class="nc" id="L598">    json.add(&quot;position&quot;, JsonParser.parseString(new Gson().toJson(field)));</span>
<span class="nc" id="L599">    object.add(&quot;value&quot;, json);</span>
<span class="nc" id="L600">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L601">  }</span>

  /**
   * @author Carina
   * @use handles that this player need to place a mole till the turnTime ends
   * @see de.thundergames.playmechanics.game.Game
   * @see Player
   * @see Mole
   */
  protected void handlePlayerPlacesMolePacket() {
<span class="nc" id="L611">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc" id="L612">    client.setCurrentPlayer(player);</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">    if (player.getClientID() == client.getClientThread().getThreadID()) {</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">      if (client.isDebug()) {</span>
<span class="nc" id="L615">        System.out.println(&quot;Client is now on to place a mole!&quot;);</span>
      }
<span class="nc" id="L617">      client.setDraw(true);</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">      if (!timerRunning) {</span>
<span class="nc" id="L619">        timerRunning = true;</span>
<span class="nc" id="L620">        timer = new Timer();</span>
<span class="nc" id="L621">        timer.schedule(</span>
<span class="nc" id="L622">          new TimerTask() {</span>
            @Override
            public void run() {
<span class="nc bnc" id="L625" title="All 2 branches missed.">              if (client.isDraw()) {</span>
<span class="nc" id="L626">                client.setDraw(false);</span>
<span class="nc" id="L627">                timerRunning = false;</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">                if (client.isDebug()) {</span>
<span class="nc" id="L629">                  System.out.println(&quot;You ran out of time!&quot;);</span>
                }
              }
<span class="nc" id="L632">            }</span>
          },
          20000);
      }
    } else {
<span class="nc bnc" id="L637" title="All 2 branches missed.">      if (client.isDebug()) {</span>
<span class="nc" id="L638">        System.out.println(</span>
          &quot;The Client &quot;
            + new Gson()
<span class="nc" id="L641">            .fromJson(packet.getValues().get(&quot;player&quot;), Player.class)</span>
<span class="nc" id="L642">            .getName()</span>
            + &quot; needs to place a mole within the next : &quot;
<span class="nc" id="L644">            + (packet.getValues().get(&quot;until&quot;).getAsLong() - System.currentTimeMillis()) + &quot; seconds!&quot;);</span>
      }
    }
<span class="nc" id="L647">    updateGameLog(player, &quot; platziert einen Maulwurf.\n&quot;);</span>
<span class="nc" id="L648">    client.setRemainingDateTime(packet.getValues().get(&quot;until&quot;).getAsLong());</span>
<span class="nc" id="L649">    updateGameRemainingDateTime();</span>
<span class="nc" id="L650">    continueRemainingTime();</span>
<span class="nc" id="L651">  }</span>

  /**
   * @author Carina
   * @use handles that the game of the client was paused
   * @see de.thundergames.playmechanics.game.Game
   */
  protected void handleGamePausedPacket() {
<span class="nc" id="L659">    updateTableView();</span>
<span class="nc" id="L660">    pausedGameRemainingTime();</span>
<span class="nc" id="L661">  }</span>

  /**
   * @author Carina
   * @use handles that a game was canceled
   * @see de.thundergames.playmechanics.game.Game
   */
  protected void handleGameCanceledPacket() {
<span class="nc" id="L669">    handleGameOverPacket();</span>
<span class="nc" id="L670">  }</span>

  /**
   * @author Carina
   * @use handles that game is now continued
   * @see de.thundergames.playmechanics.game.Game
   */
  protected void handleGameContinuedPacket() {
<span class="nc" id="L678">    updateTableView();</span>
<span class="nc" id="L679">    continuedGameRemainingTime();</span>
<span class="nc" id="L680">  }</span>

  /**
   * @author Carina
   * @use handles that the game of the client is over
   */
  protected void handleGameOverPacket() {
<span class="nc" id="L687">    var score = new Gson().fromJson(packet.getValues().get(&quot;result&quot;), Score.class);</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L689">      System.out.println(</span>
        &quot;Client: game with the id: &quot;
<span class="nc" id="L691">          + client.getGameID()</span>
          + &quot; has ended! Winners are: &quot;
<span class="nc" id="L693">          + score.getWinners());</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">      for (var player : score.getPlayers()) {</span>
<span class="nc" id="L695">        System.out.println(</span>
          &quot;Client: player with the name: &quot;
<span class="nc" id="L697">            + player.getName()</span>
            + &quot; has points: &quot;
<span class="nc" id="L699">            + score.getPoints().get(player.getClientID()));</span>
<span class="nc" id="L700">      }</span>
    }
<span class="nc" id="L702">    updateTableView();</span>
<span class="nc" id="L703">    spectatorGameOver(score);</span>
<span class="nc" id="L704">  }</span>

  /**
   * @author Carina
   * @use handles the packet that a game has started
   */
  protected void handleGameStartedPacket() {
<span class="nc" id="L711">    client.setGameState(new Gson().fromJson(packet.getValues().get(&quot;initialGameState&quot;), GameState.class));</span>
<span class="nc" id="L712">    handleFloor();</span>
<span class="nc" id="L713">    updateTableView();</span>
<span class="nc" id="L714">    var lobbyObserverGame = LobbyObserverGame.getObserver();</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">    if (lobbyObserverGame != null) {</span>
<span class="nc" id="L716">      lobbyObserverGame.spectateGame();</span>
    }
<span class="nc" id="L718">    var lobbyObserverTournamentGame = LobbyObserverTournament.getObserver();</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">    if (lobbyObserverTournamentGame != null) {</span>
<span class="nc" id="L720">      lobbyObserverTournamentGame.spectateGame();</span>
    }
<span class="nc" id="L722">  }</span>

  /**
   * @author Carina
   * @use handles the remaining Time of the client for a turn
   */
  protected void handleRemainingTimePacket() {
<span class="nc" id="L729">    client.setRemainingTime(packet.getValues().get(&quot;timeLeft&quot;).getAsLong());</span>
<span class="nc" id="L730">    updateGameRemainingTime();</span>
<span class="nc" id="L731">  }</span>

  /**
   * @author Carina
   * @use handles the historyResponsePacket from the server
   */
  protected void handleGameHistoryResponsePacket() {
<span class="nc" id="L738">  }</span>

  /**
   * @author Carina
   * @use handles that the server send this client the score of the game
   */
  public void handleScoreNotificationPacket() {
<span class="nc" id="L745">    client</span>
<span class="nc" id="L746">      .getGameState()</span>
<span class="nc" id="L747">      .setScore(new Gson().fromJson(packet.getValues().get(&quot;score&quot;), Score.class));</span>
<span class="nc" id="L748">    updateScoreTable();</span>
<span class="nc" id="L749">  }</span>

  /**
   * @author Carina
   * @use send to the server that client wants to get the score
   */
  public void getScorePacket() {
<span class="nc" id="L756">    var jsonObject = new JsonObject();</span>
<span class="nc" id="L757">    jsonObject.addProperty(&quot;type&quot;, Packets.GETSCORE.getPacketType());</span>
<span class="nc" id="L758">    jsonObject.add(&quot;value&quot;, new JsonObject());</span>
<span class="nc" id="L759">    client.getClientThread().sendPacket(new Packet(jsonObject));</span>
<span class="nc" id="L760">  }</span>

  /**
   * @author Carina
   * @use send to the server to get the GameHistory
   */
  public void getGameHistoryPacket(final int gameID) {
<span class="nc" id="L767">    var jsonObject = new JsonObject();</span>
<span class="nc" id="L768">    var json = new JsonObject();</span>
<span class="nc" id="L769">    jsonObject.addProperty(&quot;type&quot;, Packets.GETGAMEHISTORY.getPacketType());</span>
<span class="nc" id="L770">    json.addProperty(&quot;gameID&quot;, gameID);</span>
<span class="nc" id="L771">    jsonObject.add(&quot;value&quot;, json);</span>
<span class="nc" id="L772">    client.getClientThread().sendPacket(new Packet(jsonObject));</span>
<span class="nc" id="L773">  }</span>

  /**
   * @author Carina
   * @use sends to the server that the client wants to get the remaining time for this turn
   */
  public void getRemainingTimePacket() {
<span class="nc" id="L780">    var jsonObject = new JsonObject();</span>
<span class="nc" id="L781">    jsonObject.addProperty(&quot;type&quot;, Packets.GETREMAININGTIME.getPacketType());</span>
<span class="nc" id="L782">    jsonObject.add(&quot;value&quot;, new JsonObject());</span>
<span class="nc" id="L783">    client.getClientThread().sendPacket(new Packet(jsonObject));</span>
<span class="nc" id="L784">  }</span>

  /**
   * @author Carina
   * @use handles that a player left the game
   */
  protected void handlePlayerLeftPacket() {
<span class="nc" id="L791">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L793">      System.out.println(&quot;A player has left the Game + &quot; + player);</span>
    }
<span class="nc" id="L795">    client.getGameState().getActivePlayers().remove(player);</span>
<span class="nc" id="L796">    updateGameLog(player, &quot; hat das Spiel verlassen.\n&quot;);</span>
<span class="nc" id="L797">    updateTableView();</span>
<span class="nc" id="L798">    updateLobbyPlayerTable();</span>
<span class="nc" id="L799">    kickMolesOfPlayer(player);</span>
<span class="nc" id="L800">  }</span>

  /***
   * @author Carina
   * @use handles that a player was kicked from the game
   */
  protected void handlePlayerKickedFromGame() {
<span class="nc" id="L807">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc bnc" id="L808" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L809">      System.out.println(&quot;A player has left the Game + &quot; + player);</span>
    }
<span class="nc" id="L811">    client.getGameState().getActivePlayers().remove(player);</span>
<span class="nc" id="L812">    updateGameLog(player, &quot; wurde herausgeworfen.\n&quot;);</span>
<span class="nc" id="L813">    updateTableView();</span>
<span class="nc" id="L814">    kickMolesOfPlayer(player);</span>
<span class="nc" id="L815">  }</span>

  /**
   * @author Carina
   * @use send to the server that this client wants to leave a game
   */
  public void leaveGamePacket() {
<span class="nc" id="L822">    var object = new JsonObject();</span>
<span class="nc" id="L823">    object.addProperty(&quot;type&quot;, Packets.LEAVEGAME.getPacketType());</span>
<span class="nc" id="L824">    object.add(&quot;value&quot;, new JsonObject());</span>
<span class="nc" id="L825">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L827">      System.out.println(&quot;Client: left the game!&quot;);</span>
    }
<span class="nc" id="L829">    updateTableView();</span>
<span class="nc" id="L830">    client.setGameState(null);</span>
<span class="nc" id="L831">  }</span>

  /**
   * @author Carina
   * @use handles the packet that a player joined the game
   */
  protected void handlePlayerJoinedPacket() {
<span class="nc" id="L838">    var player = new Gson().fromJson(packet.getValues().get(&quot;player&quot;), Player.class);</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">      if (player.getClientID() != client.getClientThread().getThreadID()) {</span>
<span class="nc" id="L841">        System.out.println(&quot;The player: &quot; + player.getName() + &quot; has joined the Game &quot; + client.getGameID() + &quot;.&quot;);</span>
      }
    }
<span class="nc bnc" id="L844" title="All 2 branches missed.">    if (client.getGameState() != null) {</span>
<span class="nc" id="L845">      client.getGameState().getActivePlayers().add(player);</span>
    }
<span class="nc" id="L847">    updateTableView();</span>
<span class="nc" id="L848">    updateLobbyPlayerTable();</span>
<span class="nc" id="L849">  }</span>

  /**
   * @author Carina
   * @use handles the welcomeGamePacket from the server
   */
  protected void handleWelcomeGamePacket() {
<span class="nc bnc" id="L856" title="All 2 branches missed.">    if (client instanceof AI) {</span>
<span class="nc" id="L857">      ((AI) client).setPlacedMolesAmount(0);</span>
<span class="nc" id="L858">      ((AI) client).setPlacedMoles(false);</span>
    }
<span class="nc" id="L860">    client.setGameState(new Gson().fromJson(packet.getValues().get(&quot;gameState&quot;), GameState.class));</span>
<span class="nc" id="L861">    handleFloor();</span>
<span class="nc" id="L862">    spectatorJoin();</span>
<span class="nc" id="L863">  }</span>

  /**
   * @author Carina
   * @use send by server to welcome new client connection with the clientID
   */
  protected void handleWelcomePacket() {
<span class="nc bnc" id="L870" title="All 2 branches missed.">    if (!packet.getValues().get(&quot;magic&quot;).getAsString().equals(&quot;mole42&quot;)) {</span>
<span class="nc" id="L871">      System.exit(3);</span>
    }
<span class="nc" id="L873">    client.getClientThread().setThreadID(packet.getValues().get(&quot;clientID&quot;).getAsInt());</span>
<span class="nc bnc" id="L874" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L875">      System.out.println(&quot;Client connected successfully to the Server!&quot;);</span>
    }
<span class="nc" id="L877">    client.setPlayer(new Player(client));</span>
<span class="nc" id="L878">  }</span>

  /**
   * @param name
   * @author Carina
   * @use sends the login packet to the server and wants response with welcome
   */
  public void loginPacket(@NotNull final String name) {
<span class="nc" id="L886">    var object = new JsonObject();</span>
<span class="nc" id="L887">    var json = new JsonObject();</span>
<span class="nc" id="L888">    json.addProperty(&quot;name&quot;, name);</span>
<span class="nc" id="L889">    object.addProperty(&quot;type&quot;, Packets.LOGIN.getPacketType());</span>
<span class="nc" id="L890">    object.add(&quot;value&quot;, json);</span>
<span class="nc" id="L891">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L892">  }</span>

  /**
   * @author Marc
   * @use sends the logout packet to the server
   */
  public void logoutPacket() {
<span class="nc" id="L899">    var object = new JsonObject();</span>
<span class="nc" id="L900">    object.addProperty(&quot;type&quot;, Packets.LOGOUT.getPacketType());</span>
<span class="nc" id="L901">    object.add(&quot;value&quot;, new JsonObject());</span>
<span class="nc" id="L902">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L903">  }</span>

  /**
   * author Carina
   *
   * @use handles the overview packet from the server
   */
  protected void handleOverviewPacket() {
<span class="nc" id="L911">    client.getGames().clear();</span>
<span class="nc" id="L912">    client.getTournaments().clear();</span>
<span class="nc" id="L913">    client</span>
<span class="nc" id="L914">      .getGames()</span>
<span class="nc" id="L915">      .addAll(</span>
        new Gson()
<span class="nc" id="L917">          .fromJson(</span>
<span class="nc" id="L918">            packet.getValues().get(&quot;games&quot;),</span>
<span class="nc" id="L919">            new TypeToken&lt;ArrayList&lt;Game&gt;&gt;() {</span>
<span class="nc" id="L920">            }.getType()));</span>
<span class="nc" id="L921">    client</span>
<span class="nc" id="L922">      .getTournaments()</span>
<span class="nc" id="L923">      .addAll(</span>
        new Gson()
<span class="nc" id="L925">          .fromJson(</span>
<span class="nc" id="L926">            packet.getValues().get(&quot;tournaments&quot;),</span>
<span class="nc" id="L927">            new TypeToken&lt;ArrayList&lt;Tournament&gt;&gt;() {</span>
<span class="nc" id="L928">            }.getType()));</span>
<span class="nc" id="L929">    updateTableView();</span>
<span class="nc" id="L930">  }</span>

  /**
   * @author Carina
   * @use handles the joining of a player into the game
   */
  protected void handleAssignedToGamePacket() {
<span class="nc bnc" id="L937" title="All 2 branches missed.">    if (client.isDebug()) {</span>
<span class="nc" id="L938">      System.out.println(</span>
<span class="nc" id="L939">        &quot;Client joined game with the id: &quot; + packet.getValues().get(&quot;gameID&quot;).getAsInt());</span>
    }
<span class="nc" id="L941">    client.setGameID(packet.getValues().get(&quot;gameID&quot;).getAsInt());</span>
<span class="nc" id="L942">    updateTableView();</span>
<span class="nc" id="L943">    joinAssignedGame();</span>
<span class="nc" id="L944">  }</span>

  /**
   * @param gameID
   * @param player
   * @author Carina
   * @use send to the server that this client wants to join a specific game as player or spectator
   * @see de.thundergames.playmechanics.game.Game
   * @see Player
   */
  public void joinGamePacket(final int gameID, final boolean player) {
<span class="nc" id="L955">    var object = new JsonObject();</span>
<span class="nc" id="L956">    var json = new JsonObject();</span>
<span class="nc" id="L957">    json.addProperty(&quot;gameID&quot;, gameID);</span>
<span class="nc" id="L958">    json.addProperty(&quot;participant&quot;, player);</span>
<span class="nc" id="L959">    object.addProperty(&quot;type&quot;, Packets.JOINGAME.getPacketType());</span>
<span class="nc" id="L960">    object.add(&quot;value&quot;, json);</span>
<span class="nc" id="L961">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L962">  }</span>

  /**
   * @author Carina
   * @use send to the server to register as an overview observer
   */
  public void registerOverviewObserverPacket() {
<span class="nc" id="L969">    var object = new JsonObject();</span>
<span class="nc" id="L970">    object.addProperty(&quot;type&quot;, Packets.REGISTEROBSERVER.getPacketType());</span>
<span class="nc" id="L971">    object.add(&quot;value&quot;, new JsonObject());</span>
<span class="nc" id="L972">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L973">  }</span>

  /**
   * @author Marc and Nick
   * @use send to the server to unregister as an overview observer
   */
  public void unregisterOverviewObserverPacket() {
<span class="nc" id="L980">    var object = new JsonObject();</span>
<span class="nc" id="L981">    object.addProperty(&quot;type&quot;, Packets.UNREGISTEROBSERVER.getPacketType());</span>
<span class="nc" id="L982">    object.add(&quot;value&quot;, new JsonObject());</span>
<span class="nc" id="L983">    client.getClientThread().sendPacket(new Packet(object));</span>
<span class="nc" id="L984">  }</span>

  /**
   * @author Marc
   * @use update tableview of game/tournament selection
   */
  private void updateTableView() {
    // Update tableview of GameSelection
<span class="nc" id="L992">    var gameSelection = GameSelection.getGameSelection();</span>
<span class="nc bnc" id="L993" title="All 2 branches missed.">    if (gameSelection != null) gameSelection.updateTable();</span>
    // Update tableview of TournamentSelection
<span class="nc" id="L995">    var tournamentSelection = TournamentSelection.getTournamentSelection();</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">    if (tournamentSelection != null) tournamentSelection.updateTable();</span>
<span class="nc" id="L997">  }</span>

  /**
   * @author Philipp
   * @use update the Player Table if a player joined or left the game
   */
  private void updateLobbyPlayerTable() {
<span class="nc" id="L1004">    var lobbyObserverGame = LobbyObserverGame.getObserver();</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">    if (lobbyObserverGame != null) lobbyObserverGame.showNewPlayer();</span>
<span class="nc" id="L1006">  }</span>

  /**
   * @author Philipp,Issam,Marc
   * @use Update game Log Text Box
   */
  private void updateGameLog(Player player, String text) {
<span class="nc" id="L1013">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>

      //check if GameBoard is initialized before adding entry to GameLog
<span class="nc bnc" id="L1017" title="All 2 branches missed.">      if (observerGameBoard.isInitialized())</span>
      {
<span class="nc" id="L1019">        observerGameBoard.updateGameLog(player.getClientID(), player.getName(), text);</span>
      }else{
<span class="nc" id="L1021">        var timer = new Timer();</span>
<span class="nc" id="L1022">        var task = new TimerTask() {</span>
          @Override
          public void run() {
<span class="nc bnc" id="L1025" title="All 2 branches missed.">           if (observerGameBoard.isInitialized())</span>
           {
<span class="nc" id="L1027">             observerGameBoard.updateGameLog(player.getClientID(), player.getName(), text);</span>
<span class="nc" id="L1028">             timer.cancel();</span>
           }
<span class="nc" id="L1030">          }</span>
        };
<span class="nc" id="L1032">        timer.schedule(task, 0, 100);</span>
      }
    }
<span class="nc" id="L1035">  }</span>

  /**
   * @author Philipp
   * @use Updates the score table
   */
  private void updateScoreTable() {
<span class="nc" id="L1042">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1043" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1044" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.updateScoreTable();</span>
    }
<span class="nc" id="L1046">  }</span>

  /**
   * @author Marc
   * @use update remaining time of game board
   */
  private void updateGameRemainingTime() {
<span class="nc" id="L1053">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1055" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.updateRemainingTime();</span>
    }
<span class="nc" id="L1057">  }</span>

  /**
   * @author Marc, Issam, Philipp
   * @use update remaining Datetime
   */
  private void updateGameRemainingDateTime() {
<span class="nc" id="L1064">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1065" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.updateRemainingDateTime();</span>
    }
<span class="nc" id="L1068">  }</span>

  /**
   * @author Marc
   * @use paused remaining time of game board
   */
  private void pausedGameRemainingTime() {
<span class="nc" id="L1075">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1076" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.stopCountAfterTurn();</span>
    }
<span class="nc" id="L1079">  }</span>

  /**
   * @author Marc
   * @use check for pause remaining time of game board
   */
  private void checkForStopRemainingTime() {
<span class="nc" id="L1086">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.checkForStopTimer();</span>
    }
<span class="nc" id="L1090">  }</span>

  /**
   * @author Marc
   * @use continued remaining time of game board
   */
  private void continuedGameRemainingTime() {
<span class="nc" id="L1097">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1098" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1099" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.continueTimer();</span>
    }
<span class="nc" id="L1101">  }</span>

  /**
   * @author Marc
   * @use show info of invalid move or none move
   */
  private void showPenalty(Player player, String penalty, String reason, String deductedPoints) {
<span class="nc" id="L1108">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1109" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.showPenalty(player, penalty, reason, deductedPoints);</span>
    }
<span class="nc" id="L1112">  }</span>

  /**
   * @author Issam
   * @use show info of invalid move or none move
   */
  private void kickMolesOfPlayer(Player player) {
<span class="nc" id="L1119">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1120" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1121" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.kickMolesOfPlayer(player);</span>
    }
<span class="nc" id="L1123">  }</span>

  /**
   * @author Marc, Issam, Philipp
   * @use opens the game over score board screen
   */
  private void spectatorGameOver(Score score) {
<span class="nc" id="L1130">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1131" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1132" title="All 2 branches missed.">            if (observerGameBoard.isInitialized()) observerGameBoard.gameOver(score);</span>
    }
<span class="nc" id="L1134">  }</span>

  /**
   * @author Marc, Issam, Philipp
   * @use joins the spectator to the server, creating the GUI
   */
  private void spectatorJoin() {
<span class="nc" id="L1141">    var gameSelection = GameSelection.getGameSelection();</span>
<span class="nc bnc" id="L1142" title="All 2 branches missed.">    if (gameSelection != null) gameSelection.spectateGame();</span>
<span class="nc" id="L1143">    var tournamentSelection = TournamentSelection.getTournamentSelection();</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">    if (tournamentSelection != null) tournamentSelection.spectateGame();</span>
<span class="nc" id="L1145">  }</span>

  /**
   * @author Philipp
   * @use joins an assigned game
   */
  private void joinAssignedGame() {
<span class="nc" id="L1152">      var playerMenu = PlayerMenu.getPlayerMenu();</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">      if (playerMenu != null) {</span>
<span class="nc" id="L1154">        playerMenu.joinAssignedGame();</span>
      }
<span class="nc" id="L1156">  }</span>

  /**
   * @author Marc, Issam, Philipp
   * @use continue remaining time
   */
  private void continueRemainingTime() {
<span class="nc" id="L1163">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1164" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.continueRemainingTime();</span>
    }
<span class="nc" id="L1167">  }</span>

  /**
   * @author Marc, Issam, Philipp
   * @use stop remaining time
   */
  private void stopRemainingTime() {
<span class="nc" id="L1174">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1175" title="All 2 branches missed.">    if (observerGameBoard != null) {</span>
<span class="nc bnc" id="L1176" title="All 2 branches missed.">      if (observerGameBoard.isInitialized()) observerGameBoard.stopRemainingTime();</span>
    }
<span class="nc" id="L1178">  }</span>

  /**
   * @author Marc
   * @use show tournament score
   */
  private void showTournamentScore() {
<span class="nc" id="L1185">    var observerGameBoard = GameBoard.getObserver();</span>
<span class="nc bnc" id="L1186" title="All 2 branches missed.">    if (observerGameBoard != null) observerGameBoard.showTournamentScore();</span>

<span class="nc" id="L1188">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>